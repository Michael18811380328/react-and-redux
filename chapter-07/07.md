## 第七章 Redux 与服务器通信

### React 架构下访问服务器

使用 fetch 异步获取数据对象，然后浏览器进行处理

通过代理模式访问API：如果本地访问某些网站，让我们的网页APP访问所属域名下面的一个服务器API。我们需要设置 package.json

~~~json
{
  "proxy": 'http://www.weather.com/cn'
}
~~~

实际本地开发中，可以把跨域的域名，放在这里做尝试，这样就可以避免浏览器请求跨域的情况（create-react-app）。这个在开发的时候方便使用，在实际生产环境下，应该部署自己的服务器，这样便于访问。

React 框架下：在 componentDidMount 阶段中，访问 API 请求数据。

处理用户输入输出，以及服务器返回的结果，要把所有可能出错的情况都考虑到，不要相信任何的返回结果，最好新建一个 model 处理返回的结果，这样可以获取前端想要的结果，也避免后端突然改接口，造成的各种问题。

### Redux 访问服务器

在 redux-thunk 中设置数据变化：类似一个中间件：如果传递的 action 是一个函数，那么把函数的结果返回后处理；如果不是函数，那么直接返回处理。中间件：类似一个数组，数组的每一项是一个函数，然后使用数组的 reduce 方法，依次处理参数。

~~~js
// 伪代码
const middleWares = [fn1, fn2, fn3];
middleWares.reduce((a, b) => { 
	if (b is function) {
    return b(a)
  } else {
    return a;
  }
}, initData);
~~~

对于请求：可以设置三个状态：请求开始；请求成功；请求失败，对应三个 actions。

原来的逻辑：请求后，直接在组件中 setState 改变状态，驱动 view 变化；现在改成：请求后，发送对应的 action，然后 dispatch 到 store 中改变状态，再驱动 view 改变。

软件开发是团队活动，选择某个技术时，需要考虑自己和团队成员能否接受这个技术。软件开发的目的是满足产品需求，而不是炫技（当然自己要有这个能力，在中国实际开发中，至少可以清楚的看懂别人的炫技的代码的含义）。